â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ğŸ“‹ CALL LOGS VERIFICATION CHECKLIST                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Use this checklist when monitoring backend logs during a call.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ SCENARIO: User initiates call from mobile app
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

STEP 1: App sends POST /api/v1/calls/initiate
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Request:
  {
    "receiver_id": "USR_xxxxxxx",
    "call_type": "AUDIO"
  }

Backend Logs (if LOG_LEVEL=info or debug):
  
  [ ] "ğŸ”‘ Generating Agora token for call: {call_id: CALL_xxxxx}"
      â””â”€ Token generation started
  
  [ ] "Token Generation Debug for call CALL_xxxxx:"
  [ ] "  - App ID: 8b5e9417f15a48ae929783f32d3d33d4"
  [ ] "  - Certificate: 03e9b06b303e47a9b93e..."
  [ ] "  - Channel: call_CALL_xxxxx"
      â””â”€ Credentials being used
  
  [ ] "Agora token generated for call CALL_xxxxx (SECURE mode)"
      â””â”€ âœ… GOOD: Token generated with certificate
      â””â”€ âŒ BAD: "UNSECURE mode" means certificate issue
  
  [ ] "âœ… Agora credentials generated: {channel: ..., token_length: 139}"
      â””â”€ Check token_length > 100
  
  [ ] "ğŸ“ Creating call record with Agora credentials: {call_id: ..., type: AUDIO}"
  [ ] "âœ… Call record created successfully with Agora credentials saved"
      â””â”€ Token saved to database

Response to App:
  {
    "success": true,
    "call": {
      "id": "CALL_xxxxx",
      "agora_token": "0078b5e9417f15a48ae929783f32d3d33d4...",
      "channel_name": "call_CALL_xxxxx"
    }
  }

âœ… VERIFICATION POINTS:
  â”œâ”€ Token starts with "007"
  â”œâ”€ Token contains App ID (8b5e9417f15a48ae929783f32d3d33d4)
  â”œâ”€ Channel name format: call_CALL_{timestamp}{random}
  â””â”€ Token length: ~139 characters

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

STEP 2: Receiver polls GET /api/v1/calls/incoming
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Request:
  GET /api/v1/calls/incoming
  Authorization: Bearer {receiver_token}

Backend Logs:
  
  [ ] "ğŸ“ Incoming call data: {call_id: CALL_xxxxx, ...}"
  [ ] "  - agora_token_length: 139"
  [ ] "  - channel_name: call_CALL_xxxxx"
      â””â”€ Retrieved from database (same as initiation)

Response to Receiver App:
  {
    "success": true,
    "incoming_call": {
      "id": "CALL_xxxxx",
      "caller_name": "John Doe",
      "call_type": "AUDIO",
      "agora_token": "0078b5e9417f15a48ae929783f32d3d33d4...",
      "channel_name": "call_CALL_xxxxx"
    }
  }

âœ… VERIFICATION POINTS:
  â”œâ”€ Same token as Step 1 (from database)
  â”œâ”€ Same channel name as Step 1
  â””â”€ Token not regenerated (retrieved from DB)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

STEP 3: Receiver accepts call POST /api/v1/calls/{callId}/accept
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Request:
  POST /api/v1/calls/CALL_xxxxx/accept
  Authorization: Bearer {receiver_token}

Backend Logs:
  
  [ ] "Call accepted"
  [ ] Status updated to "ONGOING"
  [ ] started_at timestamp recorded

Response to Receiver App:
  {
    "success": true,
    "message": "Call accepted",
    "call": {
      "id": "CALL_xxxxx",
      "status": "ONGOING",
      "started_at": "2025-11-22T14:30:10+00:00",
      "agora_token": "0078b5e9417f15a48ae929783f32d3d33d4...",
      "channel_name": "call_CALL_xxxxx"
    }
  }

âœ… VERIFICATION POINTS:
  â”œâ”€ Same token as Step 1 and 2
  â”œâ”€ Same channel name
  â””â”€ Status = ONGOING

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” WHAT TO LOOK FOR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… SUCCESS INDICATORS:

  âœ“ Token starts with "007"
  âœ“ Token contains correct App ID
  âœ“ "SECURE mode" message (not "UNSECURE mode")
  âœ“ Token length ~139 characters
  âœ“ Channel name consistent across all 3 steps
  âœ“ Same token used throughout call lifecycle
  âœ“ No "token generation failed" errors

âŒ ERROR INDICATORS:

  âœ— "Agora App ID not configured"
    â†’ Fix: Set AGORA_APP_ID in .env
  
  âœ— "Agora project in UNSECURE mode (no certificate)"
    â†’ Fix: Set AGORA_APP_CERTIFICATE in .env
  
  âœ— "Token generation failed, falling back to UNSECURE mode"
    â†’ Fix: Check certificate is correct (32 chars)
  
  âœ— Token is empty string ("")
    â†’ Fix: Enable certificate in Agora Console
  
  âœ— Different tokens in Step 1 vs Step 2
    â†’ Fix: Check database storage of tokens

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ§ª HOW TO TEST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Terminal 1: Enable logging and start monitor
  sed -i 's/LOG_LEVEL=error/LOG_LEVEL=info/' /var/www/onlycare_admin/.env
  php artisan config:clear
  tail -f /var/www/onlycare_admin/storage/logs/laravel.log

Terminal 2: Make a test call from your mobile app
  1. Open app as User A (caller)
  2. Select a creator to call
  3. Press Call button
  4. Watch Terminal 1 for logs

Terminal 3: Accept call as receiver
  1. Open app as User B (receiver)
  2. See incoming call
  3. Accept call
  4. Watch Terminal 1 for logs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š CURRENT STATUS OF YOUR BACKEND
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Configuration Status:
  [âœ…] App ID configured: 8b5e9417f15a48ae929783f32d3d33d4
  [âœ…] App Certificate configured: 03e9b06b303e47a9b93e...ac63
  [âœ…] UID set to: 0 (correct)
  [âœ…] Role set to: PUBLISHER (1) - correct
  [âœ…] Token generation: Working (tested)
  [âœ…] Token format: Valid (007 prefix)
  [âš ï¸] Logging: LOG_LEVEL=error (won't see debug logs)

Token Generation Test:
  [âœ…] Test successful
  [âœ…] Token: 0078b5e9417f15a48ae929783f32d3d33d4AAAAID2...
  [âœ…] Length: 139 characters
  [âœ…] Mode: SECURE
  [âœ…] Speed: 0.12ms

Recommendation:
  Your backend is CORRECTLY CONFIGURED. No changes needed.
  Only enable logging (LOG_LEVEL=info) when debugging.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“š REFERENCE FILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  ğŸ“„ BACKEND_LOGS_ANALYSIS.md
     Complete analysis with examples and commands

  ğŸ“„ storage/logs/call_monitor_guide.md
     Step-by-step monitoring guide

  ğŸ”§ test_token_generation.php
     Standalone test script

  ğŸ”§ /tmp/monitor_calls.sh
     Real-time log monitor

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Last Updated: November 22, 2025
Backend Status: âœ… PRODUCTION READY

